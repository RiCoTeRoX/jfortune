(function(e){function p(e,t){return Math.floor(Math.random()*(t-e+1))+e}function d(e){return e==="counterclockwise"?-1:1}function v(i){var s,u;if(!f){f=i}s=(i-f)/o.duration;u=Bezier.cubicBezier(o.bezier.p1x,o.bezier.p1y,o.bezier.p2x,o.bezier.p2y,s);n=u*l;h.rotate(n,r);if(Math.abs(n)<Math.abs(l)){requestAnimationFrame(v)}else{t.resolve(e.isArray(o.prices)?o.prices[a]:a)}}function m(){var e=Math.abs(Math.round((i*.5+n)%i)),t=Math.abs(n-u),r=o.separator_thickness*.5,s=i-r;return e<r||e>s||t>i*.5}function d(e){return e==="counterclockwise"?-1:1}var t,n,r,i,s,o,u=0,a,f,l,c,h;e.fn.fortune=function(g){if(!g||!g.prices){throw new Error("You must define the prices.")}h=this;o=e.extend({},e.fn.fortune.defaults,g);c=e.isArray(g.prices)?o.prices.length:g.prices;i=360/c;this.spin=function(n,s){var h,m,g,y;t=e.Deferred();a=n||Math.floor(Math.random()*c);r=s||o.direction;y=d(r);m=p(o.separation,i-o.separation);h=i*((r==="counterclockwise"?c-a:a)-.5)+m;g=p(o.min_spins,o.max_spins);l=y*(360*g+h);u=f=0;requestAnimationFrame(v);return t.promise()};this.rotate=function(t,i){e.fn.fortune.rotate(n);r=i;direction_multiplier=d(r);n=t;if(m()){if(!s){e.fn.fortune.spinnerBounce(direction_multiplier);o.onSpinBounce(this);s=true}}else{e.fn.fortune.stopSpinnerBounce();s=false}u=n};return this};e.fn.fortune.rotate=function(e){h.css({transform:"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)"})};e.fn.fortune.spinnerBounce=function(e){h.siblings("."+o.spin_classname).css({transform:"rotate("+5*e+"deg)","-webkit-transform":"rotate("+5*e+"deg)"})};e.fn.fortune.stopSpinnerBounce=function(){h.siblings("."+o.spin_classname).css({transform:"rotate(0)","-webkit-transform":"rotate(0)"})};e.fn.fortune.defaults={duration:1e3,separation:2,min_spins:10,max_spins:15,direction:"clockwise",spinner_class:"spinner",bezier:{p1x:.17,p1y:.67,p2x:.12,p2y:.99},separator_thickness:3,onSpinBounce:function(){}}})(jQuery)