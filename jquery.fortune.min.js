(function(e){e.fn.fortune=function(t){if(t===undefined){throw new Error("You must define the options.prices")}var n=e.extend({},{prices:t,duration:1e3,separation:2,min_spins:10,max_spins:15,direction:1,onSpinBounce:function(){}},t);var r=this;var i=Array.isArray(n.prices)?n.prices.length:n.prices;var s=360/i;var o=false;r.spin=function(t,f){t=typeof t==="number"?t:Math.floor(Math.random()*i);if(f===-1){t=i-t}n.direction=f||n.direction;var l=e.Deferred();var c=Math.floor(s*(t-1/2)+a(n.separation,s-n.separation));var h=a(n.min_spins,n.max_spins);var p=n.direction*(360*h+c);var d=0;var v=false;o=true;r.css({transform:"rotate("+p+"deg)","-webkit-transform":"rotate("+p+"deg)",transition:"transform "+n.duration+"ms cubic-bezier(.17,.67,.12,.99)","-webkit-transition":"-webkit-transform "+n.duration+"ms cubic-bezier(.17,.67,.12,.99)"}).siblings(".spin").removeClass("bounce");var m=function(){var e=Math.floor(u(r)),t=Math.floor((e+s*.5)%s),i,a=s/5,f=s/10;d=Math.floor(e<d?d-360:d);i=e-d;if(t<a&&i<f||t<a*3&&i>=f){if(!v){r.siblings(".spin").addClass("bounce");n.onSpinBounce(r.siblings(".spin"));v=true}}else{r.siblings(".spin").removeClass("bounce");v=false}if(o){d=e;requestAnimationFrame(m)}};var g=requestAnimationFrame(m);setTimeout(function(){r.css({transform:"rotate("+n.direction*c+"deg)","-webkit-transform":"rotate("+n.direction*c+"deg)",transition:"","-webkit-transition":""}).siblings(".spin").removeClass("bounce");cancelAnimationFrame(g);l.resolve(Array.isArray(n.prices)?n.prices[t]:t);o=false},n.duration);return l.promise()};r.rotate=function(e){r.css({transform:"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)"})};var u=function(e){var t=0,n=e.css("-webkit-transform")||e.css("-moz-transform")||e.css("-ms-transform")||e.css("-o-transform")||e.css("transform");if(n!=="none"){var r=n.split("(")[1].split(")")[0].split(","),i=r[0],s=r[1],o=Math.atan2(s,i);if(o<0){o+=2*Math.PI}t=Math.round(o*(180/Math.PI))}return t};var a=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};return r}})(jQuery);