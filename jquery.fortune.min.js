!function(n){function r(n,r){return Math.floor(Math.random()*(r-n+1))+n}function e(n){return"counterclockwise"===n?-1:1}function t(r){var e,i,s;l||(l=r),e=r-l,e<p.duration?(i=e/p.duration,s=Bezier.cubicBezier(p.bezier.p1x,p.bezier.p1y,p.bezier.p2x,p.bezier.p2y,i),o=s*d,m.rotate(o,c)):m.forceEnd(),Math.abs(o)<Math.abs(d)?M=requestAnimationFrame(t):a.resolve(n.isArray(p.prices)?p.prices[h]:h)}function i(){var n=Math.abs((.5*u+o)%u),r=Math.abs(o-x),e=.5*p.separator_thickness,t=u-e;return r>=.5*u?1:e>n||n>t?2:0}function s(n){for(var r=[[Math.cos(n),Math.sin(n),0,0],[Math.sin(-n),Math.cos(n),0,0],[0,0,1,0],[0,0,0,1]],e="",t=0;t<r.length;t++)e+=(t>0?",":"")+r[t].join(",");return e}var a,o,c,u,f,p,h,m,l,d,b,M,x=0;n.fn.fortune=function(s){if(!s||!s.prices)throw new Error("You must define the prices.");return m=this,p=n.extend({},n.fn.fortune.defaults,s),b=n.isArray(s.prices)?p.prices.length:s.prices,u=360/b,this.spin=function(i,s,o){var f,m,_,v;return a=n.Deferred(),c=s||p.direction,v=e(c),o?(h=i,d=v*o):(h="number"==typeof i?i:Math.floor(Math.random()*b),m=r(p.separation,u-p.separation),f=u*(("counterclockwise"===c?b-h:h)-.5)+m,_=r(p.min_spins,p.max_spins),d=v*(360*_+f)),x=l=0,M=requestAnimationFrame(t),a.promise()},this.rotate=function(r,t){var s=i();c=t,direction_multiplier=e(c),o=r,n.fn.fortune.rotate.call(this,o),s?(1!==s&&f||p.onSpinBounce(this),n.fn.fortune.spinnerBounce.call(this,direction_multiplier),f=!0):(n.fn.fortune.stopSpinnerBounce.call(this),f=!1),x=o},this.forceEnd=function(){M&&cancelAnimationFrame(M),m.rotate(d,c),n.fn.fortune.stopSpinnerBounce.call(this),a&&a.resolve(n.isArray(p.prices)?p.prices[h]:h)},this.destroy=function(){m&&(m.removeData(),m=null)},this},n.fn.fortune.rotate=function(r){var e=s(r*Math.PI/180);n("."+p.wheel_classname,this).css({transform:"matrix3d("+e+")","-webkit-transform":"matrix3d("+e+")"})},n.fn.fortune.spinnerBounce=function(r){var e=s(5*r*Math.PI/180);n("."+p.spinner_classname,this).css({transform:"matrix3d("+e+")","-webkit-transform":"matrix3d("+e+")"})},n.fn.fortune.stopSpinnerBounce=function(){var r=s(0);n("."+p.spinner_classname,this).css({transform:"matrix3d("+r+")","-webkit-transform":"matrix3d("+r+")"})},n.fn.fortune.defaults={duration:1e3,separation:5,min_spins:10,max_spins:15,direction:"clockwise",wheel_classname:"wheel",spinner_classname:"spinner",bezier:{p1x:.17,p1y:.67,p2x:.12,p2y:.99},separator_thickness:7,onSpinBounce:function(){}}}(jQuery);